// Step 2: Test basic array indexing with bounds checking
// This tests array read access with bounds checking

struct TestArray {
mut:
	data &int
	offset int
	len int
	cap int
	flags int
	element_size int
}

fn create_test_array() TestArray {
	// Create a simple array struct for testing
	// In the real implementation, this would use __new_array()
	mut arr := TestArray{
		data: unsafe { nil }
		offset: 0
		len: 3
		cap: 3
		flags: 0
		element_size: 4
	}
	// Allocate some memory for data
	unsafe {
		arr.data = &int(malloc(12)) // 3 ints
		arr.data[0] = 10
		arr.data[1] = 20
		arr.data[2] = 30
	}
	return arr
}

fn test_array_indexing_manual(arr &TestArray, index int) int {
	// Manual bounds checking
	if index >= arr.len || index < 0 {
		panic('index out of range')
	}
	unsafe {
		return arr.data[index]
	}
}

fn main() {
	println('Step 2: Array indexing test')
	
	arr := create_test_array()
	
	// Test valid indices
	v0 := test_array_indexing_manual(&arr, 0)
	v1 := test_array_indexing_manual(&arr, 1)
	v2 := test_array_indexing_manual(&arr, 2)
	
	println(v0)
	println(v1)
	println(v2)
	
	println('Indexing OK')
}
